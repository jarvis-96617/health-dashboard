<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My Health">
    <title>å€‹äººå¥åº·å„€è¡¨æ¿</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --text-main: #ffffff;
            --text-sub: #8e8e93;
            --accent-red: #ff3b30;    /* æ´»å‹• */
            --accent-green: #34c759;  /* é‹å‹• */
            --accent-blue: #007aff;   /* ç«™ç«‹/ç¡çœ  */
            --accent-orange: #ff9500; /* æ­¥æ•¸ */
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            margin: 0;
            padding: 20px;
            padding-top: 50px; /* é¿é–‹ç€æµ· */
            -webkit-font-smoothing: antialiased;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        p.date-label {
            color: var(--text-sub);
            font-size: 14px;
            margin-top: 0;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ç¶²æ ¼ä½ˆå±€ Bento Grid */
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 18px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100px;
        }

        .card.full-width {
            grid-column: span 2;
        }

        .card-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .card-title {
            font-size: 13px;
            color: var(--text-sub);
            font-weight: 600;
            text-transform: uppercase;
        }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            margin-top: 4px;
        }

        .card-unit {
            font-size: 14px;
            color: var(--text-sub);
            font-weight: 500;
            margin-left: 2px;
        }

        /* ç‰¹å®šå¡ç‰‡æ¨£å¼å¾®èª¿ */
        .move-text { color: var(--accent-red); }
        .exercise-text { color: var(--accent-green); }
        .stand-text { color: var(--accent-blue); }

        .loading {
            text-align: center;
            color: var(--text-sub);
            margin-top: 50px;
        }

        /* åº•éƒ¨æ›´æ–°æ™‚é–“ */
        .footer {
            margin-top: 40px;
            text-align: center;
            color: #333;
            font-size: 10px;
        }
    </style>
</head>
<body>

    <div id="app">
        <h1>Health Overview</h1>
        <p class="date-label" id="currentDate">LOADING...</p>

        <div class="grid-container" id="dashboard" style="display:none;">
            <div class="card full-width">
                <div class="card-title">Activity Rings</div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <div>
                        <div class="card-value move-text" id="val_move">--</div>
                        <div class="card-unit">KCAL</div>
                    </div>
                    <div>
                        <div class="card-value exercise-text" id="val_exercise">--</div>
                        <div class="card-unit">MIN</div>
                    </div>
                    <div>
                        <div class="card-value stand-text" id="val_stand">--</div>
                        <div class="card-unit">HRS</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">ğŸ‘£</div>
                <div>
                    <div class="card-title">Steps</div>
                    <div class="card-value" id="val_steps">--</div>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">ğŸ“</div>
                <div>
                    <div class="card-title">Distance</div>
                    <div class="card-value" id="val_dist">--<span class="card-unit">KM</span></div>
                </div>
            </div>

            <div class="card full-width">
                <div class="card-icon">ğŸ›Œ Sleep Analysis</div>
                <div style="display:flex; align-items:baseline;">
                    <div class="card-value" id="val_sleep">--</div>
                    <span class="card-unit">HRS</span>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">â¤ï¸ RHR</div>
                <div>
                    <div class="card-title">Resting HR</div>
                    <div class="card-value" id="val_rhr">--<span class="card-unit">BPM</span></div>
                </div>
            </div>

             <div class="card">
                <div class="card-icon">ğŸ’§ SpO2</div>
                <div>
                    <div class="card-title">Blood Oxygen</div>
                    <div class="card-value" id="val_spo2">--<span class="card-unit">%</span></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-icon">âš¡ Speed</div>
                <div>
                    <div class="card-title">Walk Speed</div>
                    <div class="card-value" id="val_speed">--<span class="card-unit">km/h</span></div>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">ğŸ§  Mood</div>
                <div>
                    <div class="card-title">State of Mind</div>
                    <div class="card-value" style="font-size: 20px;" id="val_mood">--</div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">æ­£åœ¨åŒæ­¥é›²ç«¯æ•¸æ“š...</div>
        <div class="footer">Data sourced from Apple Health via Google Sheets</div>
    </div>

    <script>
        // â˜…â˜…â˜… è«‹å°‡ä¸‹æ–¹çš„ç¶²å€æ›æˆä½ çš„ Google Sheet CSV ç™¼å¸ƒç¶²å€ â˜…â˜…â˜…
        const SHEET_CSV_URL = https://docs.google.com/spreadsheets/d/e/2PACX-1vRt785wcLNCOLe_qDRzBphKaym23FAA9WLhRwE_2aYZSK9BwhlrRn2jB5JeGOatnvUEXWVGkYU0bpMt/pub?output=csv;

        function init() {
            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: true, // å‡è¨­ç¬¬ä¸€è¡Œæ˜¯æ¨™é¡Œ
                complete: function(results) {
                    const data = results.data;
                    console.log("Raw Data:", data);
                    
                    // å–å¾—æœ€å¾Œä¸€ç­†è³‡æ–™ (å‡è¨­æœ€æ–°çš„åœ¨æœ€ä¸‹é¢)
                    // å¦‚æœæœ‰ç©ºè¡Œï¼Œéœ€è¦éæ¿¾æ‰
                    const validData = data.filter(row => row.Date);
                    const todayData = validData[validData.length - 1];

                    if (todayData) {
                        renderDashboard(todayData);
                    } else {
                        document.getElementById('loading').innerText = "å°šç„¡è³‡æ–™ï¼Œè«‹å…ˆåŸ·è¡Œæ·å¾‘";
                    }
                },
                error: function(err) {
                    console.error("Error:", err);
                    document.getElementById('loading').innerText = "è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²å€";
                }
            });
        }

        function renderDashboard(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'grid';

            // æ›´æ–°æ—¥æœŸ
            document.getElementById('currentDate').innerText = data.Date || 'UNKNOWN DATE';

            // æ›´æ–°æ•¸å€¼ (æ ¹æ“š Google Sheet çš„ Header åç¨±)
            // è«‹ç¢ºä¿é€™è£¡çš„ key (ä¾‹å¦‚ data.Steps) èˆ‡ä½  Excel ç¬¬ä¸€è¡Œå®Œå…¨ä¸€æ¨£ï¼Œå¤§å°å¯«éœ€ç›¸ç¬¦
            updateVal('val_move', data.Move_Cal);
            updateVal('val_exercise', data.Exercise_Min);
            updateVal('val_stand', data.Stand_Hr);
            updateVal('val_steps', data.Steps);
            updateVal('val_dist', data.Distance);
            updateVal('val_sleep', data.Sleep_Hr);
            updateVal('val_rhr', data.RHR);
            updateVal('val_spo2', data.SpO2);
            updateVal('val_speed', data.Walking_Speed);
            updateVal('val_mood', data.Mood);
        }

        function updateVal(elementId, value) {
            const el = document.getElementById(elementId);
            if (el) {
                // å¦‚æœæ•¸å€¼æ˜¯ç©ºçš„æˆ– undefinedï¼Œé¡¯ç¤º --
                el.innerText = (value && value !== "") ? value : "--";
            }
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>